/**
 * Serenity UI v2017.4.180113 (https://serenityui.com)
 */
!function(t,e){e.Model=e.Observable.extend({_pristine:null,dirty:null,UUID:null,events:["change"],options:{id:null},constructor:function(t,i){e.Observable.call(this,i),this.dirty=!1,this.UUID=e.guid(),arguments.length>0&&this.initializeValues(t)},set:function(t,e){var i=this[t]!=e;if(i){var s=void 0!==this[t]?this._cloneProperty(t):void 0;this._setProperty(t,e),this.dirty=!0,this.trigger("change",{model:this,property:t,value:this[t],before:s})}return i},toJSON:function(){var t={},i=",";for(var s in e.Model.prototype)i+=s+",";for(var s in this)-1===i.indexOf(","+s+",")&&(t[s]=this[s]);return t},initializeValues:function(t){this._pristine=t,this._initProperties(t),this.dirty=!1},rollback:function(){try{if("object"==typeof this._pristine){for(var t in this._pristine)this[t]=this._pristine[t];this.dirty=!1}}catch(t){}return this},commit:function(){try{if("object"==typeof this._pristine){for(var t in this._pristine)this._pristine[t]=this[t];this.dirty=!1}}catch(t){}return this}})}(window.jQuery,window.serenity),function(t,e){e.overlay={show:function(i){var i=t.extend({element:t("body"),text:"",cssClass:""},i);return t.Deferred(function(s){var o=i.element.find(".jx-overlay");0===o.length?(o=t(e.format("<div class='jx-overlay'><div class='ui-widget-overlay ui-front'></div><div class='jx-overlay-text'>{0}</div></div>",i.text)),i.element.append(o)):(o.find(".jx-overlay-text").attr("class","jx-overlay-text"),o.find(".jx-overlay-text").text(i.text)),i.cssClass.length>0&&o.find(".jx-overlay-text").addClass(i.cssClass),o.show(),setTimeout(function(){s.resolve()},10)}).promise()},hide:function(e){var e=t.extend({element:t("body")},e),i=e.element.find(".jx-overlay");i.length>0&&i.remove()}}}(window.jQuery,window.serenity),function(t){t.widget("serenity.filtermenu",t.serenity.datawidget,{options:{dataSource:[],field:null},events:["clear","filter"],html:{content:"<div class='ui-widget-content sr-filter-input' style='width:200px;height:200px;'><span style='display: block; margin-bottom: 1em;'>Show items where:</span><select class='sr-filter-operator' style='width:175px;'><option value='eq'>equals</option><option value='neq'>not equals</option><option value='contains'>contains</option><option value='doesnotcontain'>does not contain</option><option value='startswith'>starts with</option><option value='endswith'>ends with</option><option value='empty' data-value='false'>empty</option><option value='notempty' data-value='false'>not empty</option><option value='gt'>greater than</option><option value='lt'>less than</option></select><input class='sr-input sr-filter-value' style='width:165px;margin-top:1.1em;'/><button class='sr-clear-button' style='position:absolute;bottom:10px;left:10px;'>Clear</button><button class='sr-filter-button' style='position:absolute;bottom:10px;right:10px;'>Filter</button></div>"},_create:function(){this._super(),this.setDataSource(this.options.dataSource),this._render()},_createWidgets:function(){this.element.find("button.sr-clear-button").button().data("uiButton").element.on("click",t.proxy(this._onClear,this)),this.element.find("button.sr-filter-button").button().data("uiButton").element.on("click",t.proxy(this._onFilter,this)),this.widgets.value=this.element.find("input.sr-filter-value"),this.widgets.operator=this.element.find("select.sr-filter-operator").selectmenu({width:175}).data("uiSelectmenu")},_onClear:function(t){t.stopPropagation(),this._dataSource.filter([]),this._trigger("clear")},_onFilter:function(t){t.stopPropagation();var e=this.options.field,i=this.widgets.operator.element.select().find("option:selected"),s=i.val(),o="false"!==i.attr("data-value"),n=this.widgets.value.val();e.length>0&&s.length>0&&(n.length>0||!1===o)&&(this._dataSource.filter({field:e,operator:s,value:n}),this._trigger("filter"))},_render:function(){this.element.append(this.html.content),this._createWidgets()},load:function(t){this.options.field=t;var e=Enumerable.From(this._dataSource.options.filter).Where(function(e){return e.field===t}).FirstOrDefault();void 0!==e&&(this.widgets.operator.element.val(e.operator),this.widgets.operator.refresh(),this.widgets.value.val(e.value))}})}(window.jQuery),function(t){t.widget("serenity.pagerpanel",t.serenity.datawidget,{html:{content:"<div class='ui-widget-content'><div class='sr-pagerpanel-input'><div class='sr-pagerpanel-gotopage'><span class='sr-pagerpanel-pagemessage'>Go to page:</span><input class='ui-widget-input sr-pagerpanel-pagenum' /></div><div class='sr-pagerpanel-pagesize'><span class='sr-pagerpanel-sizemessage'>Show rows:</span><select class='sr-pagerpanel-sizeselect'></select></div><div class='sr-pagerpanel-navigate'><span class='sr-pagerpanel-items'></span><button class='sr-pagerpanel-prev'></button><button class='sr-pagerpanel-next'></button></div></div></div>"},options:{dataSource:[],messages:{goto:"Go to page:",pagesize:"Show rows",items:Handlebars.compile("{{start}}-{{end}} of {{size}}")},pagesizes:[10,25,50,100]},_create:function(){this._super(),this.element.append(this.html.content),this.widgets.pageNumber=this.element.find(".sr-pagerpanel-pagenum"),this.widgets.pageNumber.on("blur",t.proxy(this._onPageNumberChange,this)),this.widgets.pageSize=this.element.find(".sr-pagerpanel-sizeselect").serenityDropdownlist({dataSource:new serenity.DataSource,textField:"size",valueField:"size",width:70,change:t.proxy(this._onPageSizeChange,this)}).data("serenityDropdownlist"),this.element.find("button.sr-pagerpanel-prev").button({icons:{primary:"fa fa-caret-left"}}).click(t.proxy(this._onPrev,this)).find(".ui-button-icon").removeClass("ui-button-icon").removeClass("ui-icon"),this.element.find("button.sr-pagerpanel-next").button({icons:{primary:"fa fa-caret-right"}}).click(t.proxy(this._onNext,this)).find(".ui-button-icon").removeClass("ui-button-icon").removeClass("ui-icon"),this.setDataSource(this.options.dataSource)},_onDataSourceChange:function(){this.load()},_onPageNumberChange:function(){var t=this.options.dataSource.options.page,e=parseInt(this.widgets.pageNumber.val());e>0&&e<=t.count?this.options.dataSource.changePage(e):this.widgets.pageNumber.val(t.current)},_onPageSizeChange:function(t,e){this._dataSource.changePage(1,this.widgets.pageSize.dataItem().size)},_onPrev:function(){var t=this.options.dataSource.options.page;t.current>1&&(this.options.dataSource.changePage(t.current-1),this.load())},_onNext:function(){var t=this.options.dataSource.options.page;t.current<t.count&&(this.options.dataSource.changePage(t.current+1),this.load())},load:function(){if(this._dataSourceValid){var e=this._dataSource.options.page;this.widgets.pageNumber.val(e.current);var i=t.merge([],this.options.pagesizes);null!==e.size&&-1===i.indexOf(e.size)&&i.push(e.size);var s=Enumerable.From(i).Select(function(t){return{size:t}}).OrderBy("$.size").ToArray();this.widgets.pageSize._dataSource.data(s),this.widgets.pageSize.value(e.size);var o=this._dataSource._current.viewCount,n=(e.current-1)*e.size,a=n+this._dataSource._current.pageCount;this.element.find(".sr-pagerpanel-items").text(this.options.messages.items({start:n+1,end:a,size:o}))}},setDataSource:function(t){this._super(t),this.load()}})}(window.jQuery),function(t){"use strict";t.widget("serenity.notificationpanel",t.serenity.widget,{_timeout:null,_notification:null,_direction:null,show:function(t){var e=this;this._notification=t;var i="bottom"===t.options.animation.show?"down":"top"===t.options.animation.show?"up":t.options.animation.show;e.element.show("slide",{direction:i},function(){e._trigger.call(e,"show"),t.options.hideOnClick&&(e.element.addClass("sr-hide-on-click"),e.element.on("click.notificationpanel",function(t){e._trigger.call(e,"click",t),clearTimeout(e._timeout),e.hide.call(e)}))}),t.options.duration>0&&(this._timeout=setTimeout(function(){e.hide.call(e)},t.options.duration))},hide:function(){var t=this;if(t.element.off("click.notificationpanel"),this.element.is(":visible")){var e="bottom"===this._notification.options.animation.hide?"down":"top"===this._notification.options.animation.hide?"up":this._notification.options.animation.hide;this.element.hide("slide",{direction:e},function(){t._trigger.call(t,"hide"),t.destroy()})}},remove:function(){this.element.off("click.notificationpanel"),this._trigger.call(this,"hide"),this.destroy()}})}(window.jQuery),function(t,e){"use strict";t.widget("serenity.rating",t.serenity.widget,{_pause:null,_pixels:null,_intermediate:null,_width:null,_interval:null,_steps:null,html:{wrapper:"<div class='sr-rating-wrapper' style='display:inline-block;'><div class='sr-rating-container' style='position:relative;display:inline-block;'></div></div>",font:{available:Handlebars.compile("<div class='sr-rating-available' style='font-size:{{fontSize}};color:{{color}};display:inline-block;'>{{content}}</div>",{noEscape:!0}),selected:Handlebars.compile("<div class='sr-rating-selected' style='font-size:{{fontSize}};color:{{color}};position:absolute;top:0px;left:0px;overflow:hidden;width:0px;'>{{content}}</div>",{noEscape:!0}),highlight:Handlebars.compile("<div class='sr-rating-highlight' style='font-size:{{fontSize}};color:{{color}};position:absolute;top:0px;left:0px;width:0px;overflow:hidden;'>{{content}}</div>",{noEscape:!0})},icon:{available:Handlebars.compile("<div class='sr-rating-available {{cssClass}}' style='height:{{height}}px;display:inline-block;width:{{width}}px;'></div>",{noEscape:!0}),selected:Handlebars.compile("<div class='sr-rating-selected {{cssClass}}' style='height:{{height}}px;position:absolute;top:0px;left:0px;overflow:hidden;width:0px;'></div>",{noEscape:!0}),highlight:Handlebars.compile("<div class='sr-rating-highlight {{cssClass}}' style='height:{{height}}px;position:absolute;top:0px;left:0px;width:0px;overflow:hidden;'></div>",{noEscape:!0})},clear:Handlebars.compile("<i class='sr-rating-clear {{cssClass}}' data-color='{{color}}' data-highlight-color='{{highlightColor}}' style='color:{{color}};float:left;'></i>",{noEscape:!0})},options:{count:5,step:.5,value:null,readonly:!1,mode:"font",font:{code:null,char:null,size:"1em",availableColor:"gray",highlightColor:"goldenrod",selectedColor:"red"},icon:{width:null,height:null,availableClass:null,highlightClass:null,selectedClass:null},clear:{visible:!0,cssClass:"fa fa-minus-circle",color:null,highlightColor:null}},_create:function(){this._super(),this.element.after(this.html.wrapper),this.widgets.wrapper=this.element.next("div.sr-rating-wrapper"),this.widgets.container=this.widgets.wrapper.find(".sr-rating-container"),this.widgets.wrapper.append(this.element),this.element.hide(),"font"===this.options.mode?this._renderFont():this._renderIcon(),this._renderClear(),this._initEvents(),this._intermediate={pixels:0,steps:0},this.load()},_renderFont:function(){for(var t="",e=null!==this.options.font.code?String.fromCharCode(this.options.font.code):null!==this.options.font.char?this.options.font.char:String.fromCharCode(9733),i=0;i<this.options.count;i++)t+=e;this.widgets.container.append(this.html.font.available({fontSize:this.options.font.size,color:this.options.font.availableColor,content:t})),this.widgets.available=this.widgets.container.find(".sr-rating-available"),this.widgets.container.append(this.html.font.selected({fontSize:this.options.font.size,color:this.options.font.selectedColor,content:t})),this.widgets.selected=this.widgets.container.find(".sr-rating-selected"),this.widgets.container.append(this.html.font.highlight({fontSize:this.options.font.size,color:this.options.font.highlightColor,content:t})),this.widgets.highlight=this.widgets.container.find(".sr-rating-highlight")},_renderIcon:function(){var t=this.options.count*this.options.icon.width,e=this.options.icon.height;this.widgets.container.append(this.html.icon.available({cssClass:this.options.icon.availableClass,height:e,width:t})),this.widgets.available=this.widgets.container.find(".sr-rating-available"),this.widgets.container.append(this.html.icon.selected({cssClass:this.options.icon.selectedClass,height:e})),this.widgets.selected=this.widgets.container.find(".sr-rating-selected"),this.widgets.container.append(this.html.icon.highlight({cssClass:this.options.icon.highlightClass,height:e})),this.widgets.highlight=this.widgets.container.find(".sr-rating-highlight")},_renderClear:function(){if(!0===this.options.clear.visible){var e=this.options.clear;null===e.color&&(e.color=this.options.font.availableColor),null===e.highlightColor&&(e.highlightColor=this.options.font.selectedColor),this.widgets.wrapper.prepend(this.html.clear(this.options.clear)),this.widgets.clear=this.widgets.wrapper.find(".sr-rating-clear"),this.widgets.clear.css("margin-top",(this.widgets.container.height()-this.widgets.clear.height())/2+"px"),this.widgets.clear.on("mouseenter",function(){var e=t(this);e.css("color",e.attr("data-highlight-color"))}),this.widgets.clear.on("mouseleave",function(){var e=t(this);e.css("color",e.attr("data-color"))});var i=this;this.widgets.clear.on("click",function(){i._intermediate={pixels:0,steps:0},i._setSelectedValue()})}},_initEvents:function(){!1===this.options.readonly&&(this.widgets.container.on("mousemove",t.proxy(this._onMouseMove,this)),this.widgets.container.on("mouseleave",t.proxy(this._onMouseLeave,this)),this.widgets.container.on("click",t.proxy(this._onClick,this)))},_initIntervalValues:function(){var t=this.widgets.available.width();this._width!==t&&(this._width=t,this._steps=this.options.count/this.options.step,this._interval=this._width/this._steps)},_onMouseMove:function(t){!0!==this._pause&&(this.widgets.selected.width(0),this._intermediate.steps=this._calculateSelectedSteps(t.offsetX),this._intermediate.pixels=this._calculateSelectedPixels(this._intermediate.steps),this.widgets.highlight.css("width",this._intermediate.pixels+"px"))},_onMouseLeave:function(){this.widgets.highlight.width(0),this.widgets.selected.width(this._pixels)},_onClick:function(){this._setSelectedValue()},_calculateSelectedSteps:function(t){var e=!1,i=0;this._initIntervalValues();for(var s=1;s<=this._steps&&!1===e;s++)t<s*this._interval&&t>(s-1)*this._interval&&(i=s,e=!0);return!0===e?i:this._intermediate.steps},_calculateSelectedPixels:function(t){return this._initIntervalValues(),t*this._interval},_convertValueToSteps:function(t){return t/this.options.step},_convertStepsToValue:function(t){return t*this.options.step},_setSelectedValue:function(){this._pause=!0,this.widgets.highlight.width(0),this.options.value=this._convertStepsToValue(this._intermediate.steps),this._pixels=this._intermediate.pixels,this.element.val(this.options.value),this.widgets.selected.css("width",this._pixels+"px"),this._trigger("change",null,{value:this.options.value});var t=this;setTimeout(function(){t._pause=!1},250)},load:function(){var e=0;if(t.isNumeric(this.options.value))e=this.options.value;else{var i=this.element.val();i.length>0&&(e=parseFloat(i))}this._pixels=this._calculateSelectedPixels(this._convertValueToSteps(e)),this.widgets.selected.css("width",this._pixels+"px")}})}(window.jQuery,window.serenity),function(t,e){t.widget("serenity.autocomplete",t.ui.autocomplete,e._dataWidgetDef),t.widget("serenity.autocomplete",t.serenity.autocomplete,{options:{dataSource:[],height:null,index:null,itemTemplate:null,text:null,textField:null,value:null,valueField:null,source:[]},_create:function(){this._super(),this.element.css("padding","5px"),this.setDataSource(this.options.dataSource)},_onDataSourceChange:function(){this.refresh()},_renderItem:function(t,e){var i=this,s=this._super(t,e);if(this._dataSourceValid()&&null!==this.options.itemTemplate){var o=s.text(),n=this._dataSource.view().Where(function(t){return t[i.options.textField]===o}).FirstOrDefault(),a=this.options.itemTemplate(n);s.html(a)}return s},setDataSource:function(t){this._super(t),this._dataSourceValid()&&(null!==this.options.index?this.index(this.options.index):null!==this.options.value?this.value(this.options.value):null!==this.options.text?this.text(this.options.text):this.refresh())},dataItem:function(){var t=this,e=this.element.val();return this._dataSource.view().Where(function(i){return i[t.options.textField]==e}).FirstOrDefault()},index:function(t){this.options.index=t,this.refresh()},text:function(t){if(void 0===t)return this.element.val();var e=this,i=!1;this._dataSource.view().ForEach(function(s,o){if(s[e.options.textField]===t)return e.options.value=s[e.options.valueField],e.options.text=t,e.options.index=o,e.refresh(),i=!0,!1}),!1===i&&this.element.val(t)},value:function(t){if(void 0!==t){var e=this;return this._dataSource.view().ForEach(function(i,s){if(i[e.options.valueField]===t)return e.options.value=t,e.options.text=i[e.options.textField],e.options.index=s,e.refresh(),!1}),this}var i=this.dataItem();if("object"==typeof i)return t=i[this.options.valueField]},refresh:function(){if(this.element.empty(),this._dataSourceValid()){var t=this,e=this._dataSource.view(),i=[],s=null;e.ForEach(function(e,o){var n=e[t.options.textField];i.push(n),t.options.index===o&&(s=n)});try{this.option("source",i),null!==s&&this.element.val(s)}catch(t){}this._trigger("dataBound"),null!==this.options.height&&this.menu.element.css({"max-height":this.options.height+"px","overflow-y":"auto","overflow-x":"hidden"})}}})}(window.jQuery,window.serenity),function(t,e){t.widget("serenity.contextmenu",t.ui.menu,e._dataWidgetDef),t.widget("serenity.contextmenu",t.serenity.contextmenu,{_target:null,_current:null,options:{dataSource:null,target:null,child:null},html:{item:Handlebars.compile("<li {{cssClass}}><div>{{text}}</div></li>",{noEscape:!0}),itemIcon:Handlebars.compile("<li {{cssClass}}><div><span class='{{icon}}'></span>{{text}}</div></li>",{noEscape:!0}),divider:"<div class='ui-menu-divider ui-widget-content'></div>"},_create:function(){var e=this;this._super(),this.element.attr("style","display:inline-block;position:absolute;"),this.element.hide(),this.element.appendTo("body"),this.target(this.options.target,this.options.child),t("body").on("click.contextmenu",function(){e.element.hide("blind",null,200)}),this.setDataSource(this.options.dataSource)},_onDataSourceChange:function(){this.refresh()},_onContextMenu:function(e){e.preventDefault(),this.open(t(e.currentTarget),e.pageY,e.pageX)},setDataSource:function(t){this._super(t),this.refresh()},open:function(t,e,i){return this._current=t,this._trigger("beforeOpen",null,{target:t}),this.element.css({top:e,left:i}),this.element.show("blind",null,200),this},refresh:function(){if(this._dataSourceValid()){var e=this._dataSource.view(),i=this,s=null;this.element.empty(),e.ForEach(function(e,o){if(!0===e.divider)s=i.html.divider;else{var n=e.icon?i.html.itemIcon:i.html.item;s=t(n({text:e.text,cssClass:e.disabled?"class='ui-state-disabled'":"",icon:e.icon})),e.icon&&"ui-icon-"===e.icon.substr(0,8)&&s.find("span").addClass("ui-icon")}i.element.append(s)});try{this._super()}catch(t){}this._trigger("dataBound")}else this._super()},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),i.target=this._current,this._trigger("select",e,i)},target:function(e,i){return e&&(null!=this._target&&this._target.off(".contextmenu"),this._target=t(e),i?this._target.on("contextmenu.contextmenu",i,t.proxy(this._onContextMenu,this)):this._target.on("contextmenu.contextmenu",t.proxy(this._onContextMenu,this))),this}})}(window.jQuery,window.serenity),function(t,e){t.widget("serenity.dropdownlist",t.ui.selectmenu,t.extend(!0,{},e._dataWidgetDef)),t.widget("serenity.dropdownlist",t.serenity.dropdownlist,{_previousValue:null,options:{dataSource:[],height:null,index:null,itemTemplate:null,placeholder:{value:null,text:null,template:null,showInList:!0},textTemplate:null,text:null,textField:"text",value:null,valueField:"value"},html:{option:Handlebars.compile("<option {{attr}}>{{text}}</option>",{noEscape:!0})},_create:function(){this._super(),this.setDataSource(this.options.dataSource)},_onDataSourceChange:function(){this.refresh()},_select:function(t,e){this._previousValue=this.element.find(":selected").val(),this._super(t,e)},_renderButtonItem:function(t){var e=this._super(t);if(null!==this.options.placeholder.text&&0===t.index){var i=null!==this.options.placeholder.template?this.options.placeholder.template(this.options.placeholder):this.options.placeholder.text;e.html(i)}else if("function"==typeof this.options.textTemplate&&this._dataSourceValid()){var s=this.options.textField,o=this._dataSource.view().Where(function(e){return e[s]===t.label}).FirstOrDefault(),n=this.options.textTemplate(o);e.html(n)}return e},_renderItem:function(t,e){var i=this._super(t,e);try{if(null!==this.options.placeholder.text&&!0===this.options.placeholder.showInList&&0===i.index())"function"==typeof this.options.placeholder.template&&i.children("div").html(this.options.placeholder.template(this.options.placeholder));else if(this._dataSourceValid()&&null!==this.options.itemTemplate){var s=i.index();null!==this.options.placeholder.text&&!0===this.options.placeholder.showInList&&(s-=1);var o=this._dataSource.view().ElementAt(s),n=this.options.itemTemplate(o);i.children("div").html(n)}}catch(t){console.log(t)}return i},_renderOptions:function(){var i=this.options.index,s=this._dataSource.view(),o=this;if(null!==this.options.placeholder.text&&!0===this.options.placeholder.showInList){var n=null!==this.options.placeholder.value?this.options.placeholder.value:"",a=this.options.placeholder.text,l=t(this.html.option({attr:e.format("value='{0}'",n),text:a}));null===i&&l.attr("selected","selected"),o.element.append(l)}s.ForEach(function(s,n){var a=t(o.html.option({attr:null!==o.options.valueField?e.format("value='{0}'","object"==typeof s[o.options.valueField]?JSON.stringify(s[o.options.valueField]):s[o.options.valueField]):"",text:null!==o.options.textField?s[o.options.textField]:""}));i===n&&a.attr("selected","selected"),o.element.append(a)})},open:function(){this._super();var t=this._getSelectedItem().get(0);t.parentNode.scrollTop=t.offsetTop},setDataSource:function(t){this._super(t),this._dataSourceValid()&&(null!==this.options.index?this.index(this.options.index):null!==this.options.value?this.value(this.options.value):null!==this.options.text?this.text(this.options.text):this.refresh())},refresh:function(){if(this.element.empty(),this._dataSourceValid()){this._renderOptions();try{this._super()}catch(t){}this._trigger("dataBound"),null!==this.options.height&&this.menuWidget().css("height",this.options.height+"px")}},previousDataItem:function(){var t=null;if(null!==this._previousValue)try{if(null!==this.options.placeholder.text&&this.options.placeholder.value==this._previousValue)t={placeholder:!0},t[this.options.textField]=this.options.placeholder.text,t[this.options.valueField]=value;else{var e=this;t=this.dataSource().view().Where(function(t){return"object"==typeof t[e.options.valueField]?JSON.stringify(t[e.options.valueField])==e._previousValue:t[e.options.valueField]==e._previousValue}).FirstOrDefault()}}catch(t){}return t},dataItem:function(){var t=this,e=this.element.select().find("option:selected").val(),i=this._dataSource.view().Where(function(i){return"object"==typeof i[t.options.valueField]?JSON.stringify(i[t.options.valueField])==e:i[t.options.valueField]==e}).FirstOrDefault();return void 0===i&&(i={},null!==this.options.placeholder.text&&this.options.placeholder.value==e&&(i.placeholder=!0,i[this.options.textField]=this.options.placeholder.text,i[this.options.valueField]=e)),i},index:function(t){this.options.index=t,this.refresh()},text:function(t){var e=this;this._dataSource.view().ForEach(function(i,s){if(i[e.options.textField]==t)return e.options.value=i[e.options.valueField],e.options.text=i[e.options.textField],e.options.index=s,e.refresh(),!1})},value:function(t){if(void 0!==t){var e=this;return!1!==this.element.select().find("option:selected").length>0&&this.options.value===t||this._dataSource.view().ForEach(function(i,s){if(i[e.options.valueField]==t)return e.options.value=i[e.options.valueField],e.options.text=i[e.options.textField],e.options.index=s,e.refresh(),!1}),this}var i=this.dataItem();if("object"==typeof i)return t=i[this.options.valueField]}})}(window.jQuery,window.serenity),function(t,e){t.widget("serenity.combobox",t.serenity.autocomplete,{options:{minLength:0,delay:0},html:{wrapper:"<span class='sr-combobox-wrapper' style='display:inline-block;position:relative;'></span>",button:"<a class='ui-button ui-widget ui-button-icon-only ui-corner-right sr-show-list-button'><span class='ui-button-icon ui-icon ui-icon-triangle-1-s'></span><span class='ui-button-icon-space'> </span></a>"},_open:null,_create:function(){var e=t(this.html.wrapper);this.element.before(e),e.append(this.element),e=this.element.closest("span.sr-combobox-wrapper"),this._super(),this.widgets.wrapper=e,this.widgets.wrapper.append(this.html.button),this.widgets.button=this.widgets.wrapper.find("a.sr-show-list-button"),this.widgets.button.on("mousedown",t.proxy(this._onShowListMouseDown,this)),this.widgets.button.on("click",t.proxy(this._onShowListClick,this));var i=this.widgets.button.width(),s=this.element.width();this.element.css("width",s-i+"px")},_onShowListMouseDown:function(){this._open=this.menu.element.is(":visible")},_onShowListClick:function(){if(!1===this._open){var t=this.element.val();this.element.trigger("focus"),this.search(t)}}})}(window.jQuery,window.serenity),function(t,e){"use strict";t.widget("serenity.timepicker",t.serenity.dropdownlist,{_modeFormat:{12:"{0:hh}:{0:mm} {0:tt}",24:"{0:t}"},options:{min:"12:00 AM",max:"11:30 PM",interval:30,mode:"12",date:null,text:null,height:250,width:150,valueField:"value",textField:"text"},setDataSource:function(){var t=this,i=Enumerable.From(e.time.list(this.options.min,this.options.max,this.options.interval,this.options.mode)).Select(function(e){return{value:e,text:"12"==t.options.mode?e.replace("00:","12:"):e}}).ToArray(),s=new e.DataSource({data:i});if(null!==this.options.date){var o=e.format(this._modeFormat[this.options.mode],this.options.date);o="12"===this.options.mode?o.replace("00:","12:"):o,this.options.text=o}this._super(s)}})}(window.jQuery,window.serenity),function(t,e){t.widget("serenity.table",t.serenity.datawidget,{_widths:null,_columns:null,html:{header:{html:{standard:"<div class='sr-table-header ui-widget-content'><table class='ui-widget-content' style='width:100%;'><colgroup></colgroup><tr></tr></table></div>",bootstrap:"<div class='sr-table-header'><table class='table' style='width:100%;margin-bottom:0px;'><colgroup></colgroup><tr></tr></table></div>"},colgroup:{col:"<col style='{0};'/>"},column:{html:{standard:"<th data-field='{0}' class='ui-widget-header' style='position:relative;'><span class='sr-table-col-text'>{1}</span></th>",bootstrap:"<th data-field='{0}' style='position:relative;'><span class='sr-table-col-text'>{1}</span></th>"},scrollbar:{standard:"<th class='ui-widget-header'></th>",bootstrap:"<th></th>"},action:{html:"<div class='sr-table-col-actions'></div>",sort:"<span class='sr-table-col-sort fa fa-sort{0}' title='Sort column'></span>",filter:{icon:"<span class='fa fa-filter' title='Filter column'></span>",popup:"<div class='sr-table-col-filter-popup' style='position:absolute;right:0px;width:200px;display:none;'></div>"}}}},checkbox:{colgroup:{col:"<col style='width:75px;'/>"},header:"<th class='ui-widget-header sr-table-checkbox-select' style='position:relative;'><i class='{0} {1}' aria-hidden='true'></i></th>",column:"<td class='sr-table-checkbox-select' style='position:relative;text-align:center;'><i class='{0} {1}' aria-hidden='true'></i></td>"},body:{html:{standard:"<div class='sr-table-body ui-widget-content' style='{0}'><table style='width:100%;'><colgroup></colgroup></table></div>",bootstrap:"<div class='sr-table-body' style='{0}'><table class='table' style='width:100%;'><colgroup></colgroup></table></div>"}},calc:{html:"<div class='sr-table-calc'><table class='ui-widget-content' style='width:100%;'><colgroup></colgroup><tr></tr></table></div>",colgroup:{col:"<col style='{0};'/>"},column:Handlebars.compile("<th data-field='{{field}}' class='ui-widget-header' style='position:relative;'><span class='sr-table-col-text' style='{{styles}}'>{{html}}</span></th>",{noEscape:!0})},pager:{html:"<div class='sr-table-pager'></div>"}},options:{tableCss:null,rowCss:null,altRowCss:"sr-table-altrow",columns:null,dataSource:[],height:"200px",pageable:!1,selectionmode:"none",mode:"standard",showCalculations:!1,rowTemplate:"<tr></tr>",renderAfterOptionChange:!0},_create:function(){this._widths=[],this._super(),this.setDataSource(this.options.dataSource),this.element.on("click.serenityTable","th.sr-table-col-sortable",t.proxy(this._onColumnSort,this)),this.element.on("click.serenityTable","th div.sr-table-col-actions span.fa-filter",t.proxy(this._onColumnFilter,this)),this.element.on("click.serenityTable","div.sr-table-header th.sr-table-checkbox-select i",t.proxy(this._onSelectAllCheckboxClick,this)),this.element.on("click.serenityTable","div.sr-table-body td.sr-table-checkbox-select i",t.proxy(this._onSelectRowCheckboxClick,this)),this.element.on("click.serenityTable","div.sr-table-body tr",t.proxy(this._onRowSelect,this))},_initSelection:function(t){"string"==typeof t.selectionmode&&t.selectionmode.indexOf("row")>0?this.element.addClass("sr-selectable"):this.element.removeClass("sr-selectable"),"checkbox"===t.selectionmode&&(this.options.selectionmode={classes:"fa",checked:"fa-check-square-o",unchecked:"fa-square-o",indeterminate:"fa-square"})},_onColumnSort:function(e){if(!(t(e.target).closest("div.sr-table-col-actions").length>0&&!1===t(e.target).hasClass("sr-table-col-sort"))){var i=t(e.currentTarget),s=i.attr("data-field"),o=i.attr("data-sort-dir");switch(o){case"asc":o="desc";break;case"desc":o="";break;default:o="asc"}var n=Enumerable.From(this._dataSource.sort()).Where(function(t){return t.field!==s}).ToArray();n.push({field:s,dir:o}),this._dataSource.sort(n)}},_onColumnFilter:function(e){e.stopPropagation();var i=t(e.currentTarget),s=i.closest("div.sr-table-col-actions"),o=s.closest("th").attr("data-field");this.widgets.filtermenu.element.appendTo(s),this.widgets.filtermenu.load(o),this.widgets.filtermenu.element.show("down"),t("body").on("click.tablefiltermenu",t.proxy(this._onBodyClick,this))},_onColumnDrop:function(e,i){var s=t(e.target),o=s.attr("data-after"),n=i.draggable.attr("data-field"),a=this._dataSource.options.group.by.slice();0===o.length?a.push(n):a.splice(a.indexOf(o)+1,0,n),this._dataSource.group({by:a})},_onColumnDragStart:function(e,i){t(e.target).draggable("instance").offset.click={left:Math.floor(i.helper.width()/2),top:Math.floor(i.helper.height()/2)}},_onBodyClick:function(e){if(this.widgets.filtermenu&&this.widgets.filtermenu.element.is(":visible")){var i=t(e.target);0===i.closest("div.sr-filtermenu").length&&!1===i.hasClass("ui-menu-item-wrapper")&&(this.widgets.filtermenu.element.hide("blind",null,200),t("body").off(".tablefiltermenu"))}},_onSelectAllCheckboxClick:function(e){var i=t(e.target);i.hasClass(this.options.selectionmode.unchecked)?this.element.find(".sr-table-checkbox-select i").removeClass(this.options.selectionmode.unchecked).addClass(this.options.selectionmode.checked):i.hasClass(this.options.selectionmode.indeterminate)?this.element.find(".sr-table-checkbox-select i").removeClass(this.options.selectionmode.unchecked).removeClass(this.options.selectionmode.indeterminate).addClass(this.options.selectionmode.checked):i.hasClass(this.options.selectionmode.checked)&&this.element.find(".sr-table-checkbox-select i").removeClass(this.options.selectionmode.checked).removeClass(this.options.selectionmode.indeterminate).addClass(this.options.selectionmode.unchecked),this._trigger("select",e)},_onSelectRowCheckboxClick:function(e){var i=t(e.target);if(i.hasClass(this.options.selectionmode.checked)){i.removeClass(this.options.selectionmode.checked).addClass(this.options.selectionmode.unchecked)
;var s=this.widgets.body.find(".sr-table-checkbox-select i");s.hasClass(this.options.selectionmode.checked)?this.widgets.header.find(".sr-table-checkbox-select i").removeClass(this.options.selectionmode.checked).removeClass(this.options.selectionmode.unchecked).addClass(this.options.selectionmode.indeterminate):this.widgets.header.find(".sr-table-checkbox-select i").removeClass(this.options.selectionmode.checked).removeClass(this.options.selectionmode.indeterminate).addClass(this.options.selectionmode.unchecked)}else{i.removeClass(this.options.selectionmode.unchecked).addClass(this.options.selectionmode.checked);var s=this.widgets.body.find(".sr-table-checkbox-select i");s.hasClass(this.options.selectionmode.unchecked)?this.widgets.header.find(".sr-table-checkbox-select i").removeClass(this.options.selectionmode.checked).removeClass(this.options.selectionmode.unchecked).addClass(this.options.selectionmode.indeterminate):this.widgets.header.find(".sr-table-checkbox-select i").removeClass(this.options.selectionmode.unchecked).removeClass(this.options.selectionmode.indeterminate).addClass(this.options.selectionmode.checked)}this._trigger("select",e)},_onRowSelect:function(e){if(this.element.hasClass("sr-selectable")){var i=t(e.currentTarget);"multiplerows"===this.options.selectionmode?i.hasClass("ui-state-active")?i.removeClass("ui-state-active"):i.addClass("ui-state-active"):(this.widgets.body.find("tr").removeClass("ui-state-active"),i.addClass("ui-state-active")),this._trigger("select",e)}},_onDataSourceChange:function(t){this.render()},_optionsSet:function(t){if("string"==typeof t.selectionmode)this._initSelection(t);else if("boolean"==typeof t.pageable&&!0===this._dataSourceValid()){var e=this.dataSource();!0===t.pageable?null===e.options.page.current&&e.changePage(1,10):(e.removePage(),e.refresh())}},_renderColumnHeader:function(i,s,o){var n=void 0!==i.title?i.title:"",a=t(e.format(this.html.header.column.html[this.options.mode],i.field,n)),l=t(this.html.header.column.action.html);if(!0===i.hidden&&a.css("display","none"),!0===i.sortable){a.addClass("sr-table-col-sortable");var r=Enumerable.From(this._dataSource.options.sort).Where(function(t){return t.field===i.field}).FirstOrDefault(),d=e.format(this.html.header.column.action.sort,void 0!==r?"-"+r.dir:"");void 0!==r&&a.attr("data-sort-dir",r.dir),l.append(d)}return!0===i.filterable&&(a.addClass("sr-table-col-filterable"),l.append(this.html.header.column.action.filter.icon)),a.append(l),o.append(a),a},_renderHeader:function(){var i=this;this.widgets.header=t(this.html.header.html[this.options.mode]);var s=this.widgets.header.find("table");null!==this.options.tableCss&&("string"==typeof this.options.tableCss?s.addClass(this.options.tableCss):"string"==typeof this.options.tableCss.header&&s.addClass(this.options.tableCss.header));var o=s.find("tr");"object"==typeof this.options.selectionmode&&(s.find("colgroup").append(this.html.checkbox.colgroup.col),o.append(e.format(this.html.checkbox.header,this.options.selectionmode.classes,this.options.selectionmode.unchecked)));for(var n=0;n<this._columns.length;n++){var a=t(e.format(this.html.header.colgroup.col,this._widths[n].width));s.find("colgroup").append(a);var l=this._columns[n];this._renderColumnHeader(l,n,o)}return this.element.append(this.widgets.header),Enumerable.From(this._columns).Where(function(t){return!0===t.filterable}).Count()>0&&(this.element.append(this.html.header.column.action.filter.popup),this.widgets.filtermenu=this.element.find("div.sr-table-col-filter-popup").serenityFiltermenu({dataSource:this._dataSource,clear:function(){i.widgets.filtermenu.element.hide("up")},filter:function(){i.widgets.filtermenu.element.hide("up")}}).data("serenityFiltermenu")),s},_renderRow:function(i,s,o,n){var a="string"==typeof this.options.rowTemplate?this.options.rowTemplate:this.options.rowTemplate(i),l=t(a);o.append(l),null!==this.options.rowCss&&s%2==0&&l.addClass(this.options.rowCss),null!==this.options.altRowCss&&s%2!=0&&l.addClass(this.options.altRowCss),n&&l.attr("data-uid",i.UUID),l.attr("data-idx",s),"object"==typeof this.options.selectionmode&&l.append(e.format(this.html.checkbox.column,this.options.selectionmode.classes,this.options.selectionmode.unchecked));for(var r=0;r<this._columns.length;r++){var d=this._columns[r],h=i[d.field];if(!0===d.group)l.append("<td class='ui-widget-header'></td>");else{void 0!==h&&null!==h||(h="");var c=d.styles?e.format(" style='{0}'","function"==typeof d.styles?d.styles(i):d.styles):"";if(void 0===d.template&&"string"==typeof d.templateSelector){var p=t(d.templateSelector).html();p.length>0&&(d.template=p)}var u="function"==typeof d.template?d.template(i):"string"==typeof d.template?Handlebars.compile(d.template)(i):h.toString(),m=t(e.format("<td{0}>{1}</td>",c,u));!0===d.hidden&&m.css("display","none"),l.append(m)}}return l},_renderBody:function(){this.widgets.body=t(e.format(this.html.body.html[this.options.mode],"undfined"!=typeof this.options.height?e.format("height:{0}",this.options.height):""));var i=this.widgets.body.find("table");null!==this.options.tableCss&&("string"==typeof this.options.tableCss?i.addClass(this.options.tableCss):"string"==typeof this.options.tableCss.body&&i.addClass(this.options.tableCss.body)),"object"==typeof this.options.selectionmode&&i.find("colgroup").append(this.html.checkbox.colgroup.col);for(var s=0;s<this._columns.length;s++){var o=t(e.format(this.html.header.colgroup.col,this._widths[s].width));i.find("colgroup").append(o)}this.element.append(this.widgets.body)},_renderAggregates:function(){this.widgets.calc=t(this.html.calc.html);var i=this.widgets.calc.find("tr"),s=this._dataSource.calculations();if("object"==typeof this.options.selectionmode){var o=t(e.format(this.html.header.colgroup.col,"width:100px;"));this.widgets.calc.find("colgroup").append(o)}for(var n=0;n<this._columns.length;n++){var o=t(e.format(this.html.header.colgroup.col,this._widths[n].width));this.widgets.calc.find("colgroup").append(o);var a=this._columns[n],l=s[a.field],r="";if(void 0!==l)if("string"==typeof a.footerTemplate){var d=Handlebars.compile(a.footerTemplate);r=d(l)}else if("function"==typeof a.footerTemplate)r=a.footerTemplate(l);else for(var h in l)r+=e.format("{0}{1}{2}: {3}",r.length>0?"<br/>":"",h[0].toUpperCase(),h.substr(1),l[h]);else"string"==typeof a.footerTemplate&&(r=a.footerTemplate);var c=t(this.html.calc.column({field:a.field,styles:a.footerStyles||"",html:r}));i.append(c)}this.element.append(this.widgets.calc)},_renderPager:function(t){this.element.append(this.html.pager.html),this.widgets.pager=this.element.find("div.sr-table-pager").serenityPagerpanel(t).data("serenityPagerpanel")},_calculateColumns:function(){if(this._columns=this.options.columns.slice(),!0===t.isArray(this.dataSource().options.group.by))for(var e=this.dataSource().options.group.by.length-1;e>=0;e--)this._columns.unshift({title:"",width:"25px",group:!0})},_calculateColumnWidths:function(){this._widths=[];for(var t=0;t<this._columns.length;t++){var i=this._columns[t],s=void 0!==i.width;this._widths.push({width:!0===i.hidden?"display:none":e.format("width:{0}",s?i.width:"100%"),hasWidth:s})}},_preLoad:function(){},_postRender:function(){},load:function(){var t=this,i=this.widgets.body.find("table");if(i.find("tr").remove(),this._dataSourceValid()){var s=this._dataSource.page();if(s.Count()>0){var o=s.First()instanceof e.Model;s.ForEach(function(e,s){t._renderRow(e,s,i,o)})}}},render:function(){var i=this;if(null!==this._dataSource&&this._dataSource instanceof e.DataSource){if(this.element.empty(),this._initSelection(this.options),this._calculateColumns(),this._calculateColumnWidths(),this._renderHeader(),this._renderBody(),this._preLoad(),this.load(),this.options.showCalculations&&null!==this._dataSource.calculations()&&this._renderAggregates(),!1!==this.options.pageable){var s=t.extend(!0,{},{dataSource:this._dataSource},"object"==typeof this.options.pageable?this.options.pageable:{});this._renderPager(s)}var o=this.widgets.body.find("table");if(this.widgets.body.height()<o.height()){var n=e.getScrollBarWidth(),a=t(e.format(this.html.header.colgroup.col,e.format("width:{0}px",n)));this.widgets.header.find("table tr").append(i.html.header.column.scrollbar[this.options.mode]),this.widgets.header.find("colgroup").append(a),this.options.showCalculations&&(this.widgets.calc.find("table tr").append(i.html.header.column.scrollbar[this.options.mode]),this.widgets.calc.find("colgroup").append(a[0].outerHTML))}this._postRender(),this._trigger("dataBound")}},setDataSource:function(t){return this._super(t),!1!==this.options.pageable&&(null!==this._dataSource.options.page.current&&null!==this._dataSource.options.page.size||(this._dataSource.options.page.current=null===this._dataSource.options.page.current?1:this._dataSource.options.page.current,this._dataSource.options.page.size=null===this._dataSource.options.page.size?10:this._dataSource.options.page.size,this._dataSource._resetCurrent())),this.render(),this},select:function(i,s){var o="string"==typeof i?this.widgets.body.find(i):i;if(void 0!==s&&!0!==s||("object"==typeof this.options.selectionmode?this.element.find(".sr-table-checkbox-select i").removeClass(this.options.selectionmode.checked).addClass(this.options.selectionmode.unchecked):this.element.find("tr.ui-state-active").removeClass("ui-state-active")),null!==i&&o.length>0)if("object"==typeof this.options.selectionmode){o.find(".sr-table-checkbox-select i").removeClass(this.options.selectionmode.unchecked).addClass(this.options.selectionmode.checked);var n=this.widgets.body.find(e.format(".sr-table-checkbox-select i.{0}",this.options.selectionmode.unchecked)).length>0,a=this.widgets.header.find(".sr-table-checkbox-select i");a.removeClass(this.options.selectionmode.checked).removeClass(this.options.selectionmode.unchecked).removeClass(this.options.selectionmode.indeterminate),a.addClass(!0===n?this.options.selectionmode.indeterminate:this.options.selectionmode.checked)}else"singlerow"===this.options.selectionmode?t(o[0]).addClass("ui-state-active"):"multiplerows"===this.options.selectionmode&&o.addClass("ui-state-active")},selectedRows:function(){return"object"==typeof this.options.selectionmode?this.widgets.body.find("tr").has(e.format("td i.{0}",this.options.selectionmode.checked)):this.widgets.body.find("tr.ui-state-active")},selectedRowItems:function(){var e=[],i=this.dataSource().page();return this.selectedRows().each(function(s,o){var n=parseInt(t(o).attr("data-idx"));e.push(i.ElementAt(n))}),e},hideColumn:function(t){var e=this,i=Enumerable.From(this._columns).Where(function(e,i){var s=!1;return"string"==typeof t?!0==(s=e.field===t)&&(e.hidden=!0):"number"==typeof t&&!0==(s=i===t)&&(e.hidden=!0),s}).ToArray();return i.length>0&&(this.render(),Enumerable.From(i).ForEach(function(t){e._trigger("columnHide",null,{column:t})})),this},showColumn:function(t){return Enumerable.From(this._columns).ForEach(function(e,i){"string"==typeof t?e.field===t&&(e.hidden=!1):"number"==typeof t&&i===t&&(e.hidden=!1)}),this.render(),this}})}(window.jQuery,window.serenity),function(t,e){"use strict";t.widget("serenity.panel",t.serenity.widget,{html:{heading:"<div class='sr-panel-heading ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-top'></div>",title:"<div class='sr-panel-title'></div>",expander:"<span class='sr-panel-expander'></span>",body:"<div class='sr-panel-body ui-widget-content ui-corner-bottom'></div>"},options:{collapsible:!1,collapsed:!1,title:"",body:"",expander:{collapse:"fa fa-minus-circle",expand:"fa fa-plus-circle"},width:"100%"},_create:function(){this._super(),this.render()},render:function(){var e=this;this.element.addClass("ui-widget ui-accordion"),this.element.css("width",this.options.width);var i=this.element.children("div");this.element.prepend(this.html.heading),this.widgets.heading=this.element.find(".sr-panel-heading"),0===i.length?(this.widgets.heading.append(this.html.title),this.title(this.options.title),this.element.append(this.html.body),this.widgets.body=this.element.find(".sr-panel-body"),this.body(this.options.body)):2===i.length&&(t(i[0]).addClass("sr-panel-title").appendTo(this.widgets.heading),this.widgets.body=t(i[1]),this.widgets.body.addClass("sr-panel-body ui-widget-content ui-corner-bottom")),this.widgets.body=this.element.find(".sr-panel-body"),this.collapsible(this.options.collapsible),this.options.collapsible&&this.options.collapsed&&this.toggle(!1),this.element.on("click.sr-panel",".sr-panel-heading.sr-panel-collapsible",function(){e.toggle.call(e)})},toggle:function(t){var e=this.widgets.body.is(":visible");return(0===arguments.length||t&&!e||!t&&e)&&(e?(this.widgets.expander.removeClass(this.options.expander.collapse).addClass(this.options.expander.expand),this.widgets.heading.addClass("ui-corner-bottom"),this.widgets.body.hide(),this._trigger("close")):(this.widgets.expander.removeClass(this.options.expander.expand).addClass(this.options.expander.collapse),this.widgets.heading.removeClass("ui-corner-bottom"),this.widgets.body.show(),this._trigger("open"))),this},title:function(t){return this.widgets.heading.find(".sr-panel-title").text(t),this},body:function(t){this.widgets.body.html(t)},collapsible:function(t){this.widgets.heading.find(".sr-panel-expander").remove(),!0===t||"left"===t?(this.widgets.heading.prepend(this.html.expander),this.widgets.expander=this.widgets.heading.find(".sr-panel-expander"),this.widgets.expander.addClass("sr-panel-expander-left"),this.widgets.expander.addClass(this.options.expander.collapse),this.widgets.heading.addClass("sr-panel-collapsible")):"right"===t&&(this.widgets.heading.append(this.html.expander),this.widgets.expander=this.widgets.heading.find(".sr-panel-expander"),this.widgets.expander.addClass("sr-panel-expander-right"),this.widgets.expander.addClass(this.options.expander.collapse),this.widgets.heading.addClass("sr-panel-collapsible"))}})}(window.jQuery,window.serenity),function(t){"use strict";t.widget("serenity.notification",t.serenity.widget,{_container:null,html:{container:"<div class='sr-notification-container'></div>",instance:"<div class='ui-widget ui-widget-content sr-notification-instance' style='display:none;'></div>",instanceContainer:"<div class='sr-notification-instance-container'></div>"},options:{position:{top:null,left:null,bottom:20,right:20},animation:{show:"bottom",hide:"bottom"},cssClass:"",hideOnClick:!0,duration:3e3,width:200},_create:function(){this._super(),this.render()},render:function(){return this.element.hide(),this.widgets.container=t(this.html.container),this.widgets.container.appendTo("body"),this.widgets.panels={},this._trigger("render"),this},show:function(e){var i={},s=this,o=t(window),n=t(this.element.children()[0]),a=!0;if(arguments.length>0&&("boolean"==typeof e?a=e:n=e instanceof jQuery?e:"string"==typeof e?t(e):n),a){var l=t(this.html.instance);l.append(n.html().trim()),l.css("width",this.options.width+"px").addClass(this.options.cssClass);var r=t(this.html.instanceContainer);r.append(l),null!==this.options.position.bottom?r.prependTo(this.widgets.container):r.appendTo(this.widgets.container),r.css("height",l.outerHeight()+"px");var d=l.serenityNotificationpanel({show:function(t,e){s._trigger("show",null,{panel:e.sender})},hide:function(t,e){s._trigger("hide",null,{panel:e.sender}),e.sender.element.remove(),e.sender.destroy(),delete s.widgets.panels[e.sender.uuid],0===s.widgets.container.find("div.sr-notification-instance").length&&(s.widgets.container.empty(),s._trigger("hide",null,{panel:e.sender}))},click:function(t,e){s._trigger("click",t,{panel:e.sender})}}).data("serenityNotificationpanel");return this.widgets.panels[d.uuid]=d,null!==this.options.position.right?i.left=o.width()+o.scrollLeft()-0-l.outerWidth()-this.options.position.right+"px":null!==this.options.position.left&&(i.left=o.scrollLeft()+this.options.position.left+"px"),null!==this.options.position.bottom?i.top=o.height()+o.scrollTop()-0-this.widgets.container.outerHeight()-this.options.position.bottom+"px":null!==this.options.position.top&&(i.top=o.scrollTop()+this.options.position.top+"px"),this.widgets.container.css("width",this.options.width+"px").css(i),d.show(this),d}},hide:function(t){if(void 0===t)this.hideAll();else{var e=this.widgets.panels[t];void 0!==e&&e.hide()}return this},hideAll:function(){for(var t in this.widgets.panels){this.widgets.panels[t].hide()}return this},remove:function(t){if(void 0===t)this.removeAll();else{var e=this.widgets.panels[t];void 0!==e&&e.remove()}return this},removeAll:function(){for(var t in this.widgets.panels){this.widgets.panels[t].remove()}return this}})}(window.jQuery),function(t,e){t.widget("serenity.listview",t.serenity.datawidget,{_mode:null,html:{heading:"<div class='sr-listview-heading ui-widget-content'><select class='sr-listview-mode'></select></div>",body:"<div class='sr-listview-body'></div>",pager:"<div class='sr-listview-pager'></div>",list:{item:"<div class='sr-listview-item sr-{{mode.view}}-mode'><div class='sr-content'>{{content}}</div></div>"},tile:{item:"<div class='sr-listview-item sr-{{mode.view}}-mode sr-content'>{{content}}</div>"}},options:{mode:"list",selectable:!1,pageable:!1,list:{template:"{{titleField}}",templateSelector:null,border:!0,selector:".sr-content",selectedClass:"ui-state-active"},tile:{template:"{{titleField}}",templateSelector:null,height:150,width:150,selector:".sr-content",selectedClass:"ui-state-active"},titleField:"title",height:null,initialMode:{view:"list",selectable:!1}},_create:function(){this._super(),this.element.addClass("ui-widget-content"),null!==this.options.height&&(this.element.css("height",this.options.height),this.element.addClass("sr-fixed-height")),this._initMode(),this._renderHeading(),this._renderBody(),this.setDataSource(this.options.dataSource),this._renderPager()},_initEventsHandlers:function(){!0===this.options.selectable&&this.widgets.body.find(this.options[this._mode.view].selector).on("click.serenityListview",t.proxy(this._onSelectItem,this))},_initMode:function(){var e=null;"string"==typeof this.options.mode?e={view:this.options.mode}:"object"==typeof this.options.mode&&(e=this.options.mode),this._mode=t.extend(this.options.initialMode,e)},_onSelectItem:function(e){var i=t(e.target),s=i.closest(".sr-listview-item").index(),o=this.options[this._mode.view];"string"==typeof o.selectedClass&&(this.element.find(o.selector).removeClass(o.selectedClass),i.addClass(o.selectedClass));var n=this.dataSource().page().ElementAt(s);this._trigger("select",e,{item:n})},_onModeChange:function(t){this._mode.view=this.widgets.heading.mode.dataItem().value,this._trigger("modeChange",t,{mode:this._mode.view}),this.render()},_onDataSourceChange:function(t){this.render()},_renderHeading:function(){!0===this.options.mode.selectable&&(this.element.append(this.html.heading),this.widgets.heading=this.element.children(".sr-listview-heading"),this.widgets.heading.mode=this.widgets.heading.children(".sr-listview-mode").serenityDropdownlist({dataSource:[{value:"list",text:"List"},{value:"tile",text:"Tile"}],width:100,value:this._mode.view,change:t.proxy(this._onModeChange,this)}).data("serenityDropdownlist"))},_renderBody:function(){this.element.append(this.html.body),this.widgets.body=this.element.children(".sr-listview-body"),!0===this.options.mode.selectable?this.widgets.body.css("top","40px"):this.widgets.body.css("top","0px"),!0===this.options.pageable?this.widgets.body.css("bottom","28px"):this.widgets.body.css("bottom","0px")},_renderPager:function(){if(!1!==this.options.pageable){var e=this,i=t.extend(!0,{},{dataSource:this._dataSource},"object"==typeof this.options.pageable?this.options.pageable:{});this.element.append(this.html.pager),this.widgets.pager=this.element.children(".sr-listview-pager").serenityPagerpanel(i).data("serenityPagerpanel"),this._dataSource.bind("change",function(t){"page"===t.type&&e._trigger("pageChange",null,{page:{before:t.before.current,current:t.value.current}})})}},setDataSource:function(t){this._super(t),!1!==this.options.pageable&&(null!==this._dataSource.options.page.current&&null!==this._dataSource.options.page.size||(this._dataSource.options.page.current=null===this._dataSource.options.page.current?1:this._dataSource.options.page.current,this._dataSource.options.page.size=null===this._dataSource.options.page.size?10:this._dataSource.options.page.size,this._dataSource._resetCurrent())),this.render()},render:function(){if(this.dataSource()instanceof e.DataSource){var i=this,s=null,o=Handlebars.compile(this.html[this._mode.view].item,{noEscape:!0});if("string"==typeof this.options[this._mode.view].templateSelector){var n=t(this.options[this._mode.view].templateSelector);n.length>0&&(this.options[this._mode.view].template=Handlebars.compile(n.html(),{noEscape:!0}))}s="function"==typeof this.options[this._mode.view].template?this.options[this._mode.view].template:Handlebars.compile(this.options[this._mode.view].template,{noEscape:!0}),this.widgets.body.empty(),this.widgets.body.off(".serenityListview"),this.dataSource().page().ForEach(function(e){var n=t.extend({titleField:e[i.options.titleField]},e),a=s(n),l=t(o({mode:i._mode,content:a}));"tile"===i._mode.view?l.height(i.options.tile.height).width(i.options.tile.width).addClass("ui-widget-content"):!0===i.options.list.border&&l.addClass("ui-widget-content"),i.widgets.body.append(l)}),!0===this.options.selectable&&(this._mode.view,this.widgets.body.find(".sr-content").addClass("sr-selectable")),this._initEventsHandlers(),this._trigger("dataBound")}}})}(window.jQuery,window.serenity),function(t,e){"use strict";t.widget("serenity.tree",t.serenity.datawidget,{_mode:null,html:{root:"<ul class='sr-tree-root'></ul>",node:Handlebars.compile("<li class='sr-tree-node sr-tree-{{expanded}}' data-uuid='{{uuid}}'><i class='sr-tree-node-arrow {{arrow}}' aria-hidden='true'></i><div class='sr-tree-node-text'><div>{{text}}</div></div></li>",{noEscape:!0}),imageCss:"<i class='sr-icon sr-node-icon {{imageCss}}'></i>",imageUrl:"",children:"<ul class='sr-tree-children'></li>"},options:{itemFields:{id:"id",parent:"parent",text:"text",hasChildren:"hasChildren",expanded:"expanded",imageCss:"imageCss",imageCssExpand:"imageCssExpand"},textTemplate:null},_create:function(){this._super(),this.element.addClass("ui-widget ui-widget-content"),this.element.append(this.html.root),this.widgets.root=this.element.find(".sr-tree-root"),this.setDataSource(this.options.dataSource),this._createEvents()},_onDataSourceChange:function(t){if("add"===t.action){var e=this.options.itemFields,i=this.dataSource().get(function(i){return i[e.id]===t.item[e.parent]}),s=this.itemNode(i),o=s.children(".sr-tree-children");o.children(".sr-tree-node-loading").remove();this._addNodeElement(o,t.item).append(this.html.children)}else"remove"===t.action&&this.itemNode(t.item).remove()},_onClickNodeArrow:function(e){var i=t(e.currentTarget).parent();i.hasClass("sr-tree-expand")?this.collapseNode(i):this.expandNode(i)},_onClickNodeText:function(e){this.element.find(".ui-state-active").removeClass("ui-state-active");var i=t(e.currentTarget),s=i.closest("li.sr-tree-node");this.selectNode(s)},_createEvents:function(){this.element.on("click",".sr-tree-node-arrow",t.proxy(this._onClickNodeArrow,this)),this.element.on("click",".sr-tree-node-text",t.proxy(this._onClickNodeText,this))},_addNodeElement:function(e,i){var s=this.options.itemFields,o=!0===i[this.options.itemFields.expanded],n="flat"===this._mode?this.dataSource().view().Where(function(t){return t[s.parent]===i[s.id]}).Count()>0:t.isArray(i.children),a=null===this.options.textTemplate?i[s.text]:"function"==typeof this.options.textTemplate?this.options.textTemplate(i):Handlebars.compile(this.options.textTemplate,{noEscape:!0})(i),l=this.html.node({uuid:i.UUID,expanded:o?"expand":"collapse",arrow:n?o?"ui-icon ui-icon-triangle-1-se":"ui-icon ui-icon-triangle-1-e":"",text:a}),r=t(l);return o?"string"==typeof i[this.options.itemFields.imageCssExpand]&&r.find(".sr-tree-node-text").prepend(this.html.imageCss.replace("{{imageCss}}",i[this.options.itemFields.imageCssExpand])):"string"==typeof i[this.options.itemFields.imageCss]&&r.find(".sr-tree-node-text").prepend(this.html.imageCss.replace("{{imageCss}}",i[this.options.itemFields.imageCss])),e.append(r),r},_addNodeElements:function(e,i){var s=this,o=this.options.itemFields;i.ForEach(function(i){var n=s._addNodeElement(e,i);if("flat"===s._mode){var a=s.dataSource().view().Where(function(t){return t[o.parent]===i[o.id]});s._addChildNodes(n,a)}else t.isArray(i[o.children])&&s._addChildNodes(n,Enumerable.From(i[o.children]))})},_rootNodes:function(t){this.widgets.root.empty(),this._addRootNodes(t)},_addRootNodes:function(t){this._addNodeElements(this.widgets.root,t)},_addChildNodes:function(t,e){var i=t.children(".sr-tree-children");0===i.length&&(t.append(this.html.children),i=t.children(".sr-tree-children")),this._addNodeElements(i,e)},_expandNode:function(t){var i=null,s=t.children(".sr-tree-node-arrow");t.removeClass("sr-tree-collapse").addClass("sr-tree-expand"),s.removeClass("ui-icon-triangle-1-e").addClass("ui-icon-triangle-1-se");var o=t.children(".sr-tree-node-text").children(".sr-node-icon");return o.length>0&&(i=this.nodeItem(t),"string"==typeof i[this.options.itemFields.imageCssExpand]&&o.attr("class",e.format("sr-icon sr-node-icon {0}",i[this.options.itemFields.imageCssExpand]))),i},setDataSource:function(t){this._super(t),this.render()},render:function(){if(this._dataSourceValid()){var t=this.options.itemFields,e=null;this._mode="flat","flat"===this._mode&&(e=this.dataSource().view().Where(function(e){return void 0===e[t.parent]||null===e[t.parent]})),this._rootNodes(e),this._trigger("dataBound")}},nodeItem:function(t){var e=t.attr("data-uuid");return this.dataSource().view().Where(function(t){return t.UUID===e}).FirstOrDefault()},itemNode:function(t){return this.element.find(e.format("li[data-uuid='{0}']",t.UUID))},expandNode:function(t){this._expandNode(t);this._trigger("expand",null,{node:t})},collapseNode:function(t){var i=t.children(".sr-tree-node-arrow");t.removeClass("sr-tree-expand").addClass("sr-tree-collapse"),i.removeClass("ui-icon-triangle-1-se").addClass("ui-icon-triangle-1-e");var s=t.children(".sr-tree-node-text").children(".sr-node-icon");if(s.length>0){var o=this.nodeItem(t);"string"==typeof o[this.options.itemFields.imageCss]&&s.attr("class",e.format("sr-icon sr-node-icon {0}",o[this.options.itemFields.imageCss]))}this._trigger("collapse",null,{node:t})},toggleNode:function(t,e){e?this.expandNode(t):this.collapseNode(t)},selectNode:function(t){this.element.find(".ui-state-active").removeClass("ui-state-active"),t.children(".sr-tree-node-text").addClass("ui-state-active"),this._trigger("select",null,{node:t})},add:function(e){if(t.isArray(e))for(var i=0;i<e.length;i++)this.dataSource().add(e[i]);else"object"==typeof e&&this.dataSource().add(e);return this},remove:function(e){var i=this.dataSource(),s=this.options.itemFields,o=function(t){var e=i.get(function(e){return e[s.parent]==t[s.id]});Enumerable.From(e).ForEach(function(t){o(t),i.remove(t)})};if(t.isArray(e))for(var n=0;n<e.length;n++)o(e[n]),i.remove(e[n]),this.itemNode(item).remove();else"object"==typeof e&&(o(e),i.remove(e),this.itemNode(e).remove());return this},findByText:function(e){var i=this.dataSource().get(function(t){return t.text===e});return t.isArray(i)&&(i=i[0]),this.findByUuid(i.UUID)},findByUuid:function(t){return this.element.find(e.format("li[data-uuid='{0}']",t))},parent:function(t){return t.parent().closest("li.sr-tree-node")},expandTo:function(t){if(!1===t.is(":visible")){var e=this.parent(t);this._expandNode(e),this.expandTo(e)}}})}(window.jQuery,window.serenity);